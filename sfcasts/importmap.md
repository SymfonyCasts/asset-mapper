# JavaScript & importmap

Coming soon...

Let's start by removing this image tag. I can actually see our normal page over here. There we go. As cool as that penguin guy is, we still have him up here in the logo. When we refresh the page right now, notice we do have this console.log coming, which says it's coming from assets.app.js. We saw that earlier in assets.app.js. We do have that console.log. We already know that we can write modern ES6 class codes in here. We can add import code in here. We're going to do all of that. But my first question is, how and why is this file being executed? We know that our style tag, our CSS, is being executed thanks to the nice, boring link tag up here. But we don't see a script tag down here in this JavaScript section. However, we do see this little import map function. That is the key. Back over on the page, I'm going to view the page source. Down here, this is what that import map is adding. We're going to talk about all parts of this, but the most important thing I want you to look at right now is the bottom. Check this out. Import, script type equals module, import app. If you remember from the first part of this video, when we created an app.js file inside of our public directory, that's how we created it. We said import and then the path to that file. But wait a second. That's still not quite right, right? It just says app. Shouldn't it say something like slash assets slash app.something.js? How does it know that app is actually referring to the built version, the final version of this file? Well, that is where this import map thing comes from up here. This is generated from an import map.php file inside of our project. This import map.php file is not super interesting yet. It's actually going to become more useful soon when we talk about third party JavaScript packages, but it does have this app key here that's pointing to the logical path to app.js. Thanks to this, this special script type equals import map dumps onto the page.  Whenever you import something like app, whenever you import something that doesn't start with a dot slash or dot dot slash, that's considered a bare import. We usually see this for third party libraries. But in the browser environment, when it sees a bare import, your browser looks for an import map on the page and looks to see if there's a matching import. Our browser sees import app. It finds this key here and that's actually the path that it downloads. It's almost like, imagine I copied this path here and I just basically pasted it right there. That's what's happening. That's why our app.js file is being output, is being executed. The import map outputs our import map, but it also outputs this extra little script type equals module to bootstrap our application. The great thing about this import map thing up here is it's not a symphony thing. This is just an internet thing. It's how your browser works. Sure, we have this import map dot php file as a symphony thing that we use to generate this. But once this is on the page, your browser is the star. It's doing all the work. And this import map thing works in all browsers. That's actually a small lie. If we go to caniuse.com and search for import map, you can see this actually only works in 81% of the browsers, which is a little bit low. But fortunately, one other thing that that import map function dumps is a shim. You can see it right here. So we include an actual JavaScript file that if your user's browser doesn't support import map, this adds that functionality. So that's why you don't need to worry about browser support for import map. It's just going to work. All right, so more on the import map in a minute. It's going to get even more interesting when we start bringing in third party JavaScript. All right, so let's go into app.js. And let's add a little bit of modern code here. In fact, I'm going to go into assets and create a new directory called lib. And inside there, a new file called vinyl.js. And I'm going to paste in the same kind of simple class that we had earlier. Back over in app.js. We're just going to import that.  So I'm going to say import vinyl and even hit tab from, and it filled in the.slash vinyl for me. And I'll instantiate it using the same stuff as before, and then console.log mix.describe. Cool? This is great. We're just coding like normal using.slash just like we would do in any situation. And when we go over and refresh, it doesn't work. And check out 404 to.slash assets.slash lib.slash vinyl coming from our app.js file. So what's going on here? Well, we're going to talk more about debugging problems later, but one hint. If you ever see that your browser is trying to download a path that doesn't have a versioned file name, something is wrong with your path. Like you have some sort of typo in your path. And in this case, the problem is we need to have the.js. So it turns out leaving the.js off is kind of a node thing when you're actually programming in the node language. But in true JavaScript environments like in your browser, you should include the extension .js. So without the.js, this was not found inside of the... Now I'll refresh. It works. Now if you want that to happen automatically via autocomplete, you can go into your PhpStorm settings, search for use file extension. There we go. Code style JavaScript. And you can change use file extension to always. So check this out. Now if I say import vinyl and tab, that time when it autocompleted it, it added the.js on the end for me. So cool. This is working. But there's like one last little cool thing happening behind the scenes. I'm gonna show you. So next is console.log here. I'm gonna click this just as an easy way to see the source of our app.js file. And check it up here. It says import. This is exactly what our file looks like. You can say import from.slash lib slash vinyl.js. There's just one problem. That's not the final file name to vinyl.js. If we go into our network tools over here and go to JavaScript and I'll search here for vinyl, remember all files served by AssetMapper have a versioned part of their file name. So how the heck is our browser seeing.slash lib slash vinyl. js but apparently somehow knowing that it should get this vinyl-long file name.js? This is one of my favorite things. The answer, if you view the page source, is the import map. So this import map is built from two sources. The first one is obvious. It's import map.php. And we're gonna add some more entries to this soon. The second one though is whenever your JavaScript imports other JavaScript using relative paths, AssetMapper automatically adds that path to the import map. This is really powerful because it means that your final code can look like.slash lib slash vinyl.js but it's actually going to be able to read that from the map and actually download the final file. So once again, it's the import map that's coming to the rescue here. It's kind of an internal detail but it's a cool thing to see how that works. All right, so we've talked about import maps a little bit but we haven't really touched on the biggest superpower of them which is using third-party packages. Let's do that next.
